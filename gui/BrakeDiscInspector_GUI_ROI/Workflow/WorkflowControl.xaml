<UserControl x:Class="BrakeDiscInspector_GUI_ROI.Workflow.WorkflowControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:w="clr-namespace:BrakeDiscInspector_GUI_ROI.Workflow"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="480">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="10" Orientation="Vertical">
            <StackPanel.Resources>
                <Style TargetType="GroupBox">
                    <Setter Property="Margin" Value="0,0,0,12"/>
                </Style>
            </StackPanel.Resources>

            <GroupBox Header="Scale">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="mm/px" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1" Margin="8,0,0,0" Width="120"
                             Text="{Binding MmPerPx, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:F4}}"/>
                </Grid>
            </GroupBox>

            <GroupBox Header="Inspection ROIs">
                <DockPanel Margin="8">
                    <StackPanel DockPanel.Dock="Bottom" Margin="0,12,0,0">
                        <!-- Per-selected-ROI summary -->
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Score:"/>
                            <TextBlock Text="{Binding SelectedInspectionRoi.LastScore, StringFormat={}{0:0.000}}" Margin="4,0,12,0"/>
                            <TextBlock Text="Threshold:"/>
                            <TextBlock Text="{Binding SelectedInspectionRoi.CalibratedThreshold, StringFormat={}{0:0.000}}" Margin="4,0,12,0"/>
                            <TextBlock Text="Result:"/>
                            <TextBlock Margin="4,0,0,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="—"/>
                                        <Setter Property="Foreground" Value="Gray"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedInspectionRoi.LastResultOk}" Value="True">
                                                <Setter Property="Text" Value="OK"/>
                                                <Setter Property="Foreground" Value="ForestGreen"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedInspectionRoi.LastResultOk}" Value="False">
                                                <Setter Property="Text" Value="NOK"/>
                                                <Setter Property="Foreground" Value="DarkRed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                            <ui:Button Command="{Binding InferEnabledRoisCommand}"
                                       Padding="12,4">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Checkmark24}" Margin="0,0,8,0"/>
                                    <TextBlock Text="Infer Enabled" VerticalAlignment="Center"/>
                                </StackPanel>
                            </ui:Button>
                        </StackPanel>
                    </StackPanel>
                    <w:InspectionDatasetTabsControl x:Name="InspectionDatasetTabs"/>
                </DockPanel>
            </GroupBox>

            <GroupBox Header="Visualization">
                <StackPanel Margin="8">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Heatmap opacity" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <Slider Minimum="0" Maximum="1" Width="200" Margin="0,0,8,0"
                                Value="{Binding HeatmapOpacity, Mode=TwoWay}"/>
                        <TextBlock Text="{Binding HeatmapOpacity, StringFormat={}{0:F2}}" VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Local threshold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <Slider Minimum="0" Maximum="5" Width="200" Margin="0,0,8,0"
                                Value="{Binding LocalThreshold, Mode=TwoWay}"/>
                        <TextBox Width="80" Text="{Binding LocalThreshold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:F3}}"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <WrapPanel Margin="0,0,0,12">
                <ui:Button Padding="12,4"
                           Click="ClearCanvasButton_Click">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Eraser24}" Margin="0,0,8,0"/>
                        <TextBlock Text="Clear Canvas" VerticalAlignment="Center"/>
                    </StackPanel>
                </ui:Button>
            </WrapPanel>

            <GroupBox Header="Regions">
                <ListView ItemsSource="{Binding Regions}" Height="160">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="x" DisplayMemberBinding="{Binding x, StringFormat={}{0:F1}}" Width="60"/>
                            <GridViewColumn Header="y" DisplayMemberBinding="{Binding y, StringFormat={}{0:F1}}" Width="60"/>
                            <GridViewColumn Header="w" DisplayMemberBinding="{Binding w, StringFormat={}{0:F1}}" Width="60"/>
                            <GridViewColumn Header="h" DisplayMemberBinding="{Binding h, StringFormat={}{0:F1}}" Width="60"/>
                            <GridViewColumn Header="area px" DisplayMemberBinding="{Binding area_px, StringFormat={}{0:F1}}" Width="80"/>
                            <GridViewColumn Header="area mm²" DisplayMemberBinding="{Binding area_mm2, StringFormat={}{0:F2}}" Width="100"/>
                        </GridView>
                    </ListView.View>
                </ListView>
            </GroupBox>
        </StackPanel>
    </ScrollViewer>
</UserControl>
