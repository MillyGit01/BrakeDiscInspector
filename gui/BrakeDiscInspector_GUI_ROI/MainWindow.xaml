<Window x:Class="BrakeDiscInspector_GUI_ROI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:BrakeDiscInspector_GUI_ROI"
        xmlns:m="clr-namespace:BrakeDiscInspector_GUI_ROI.Models"
        xmlns:workflow="clr-namespace:BrakeDiscInspector_GUI_ROI.Workflow"
        xmlns:conv="clr-namespace:BrakeDiscInspector_GUI_ROI.Converters"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        Title="BrakeDiscInspector"
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
        UseLayoutRounding="True"
        Loaded="MainWindow_Loaded">

  <Window.Resources>
      <conv:BoolToEditSaveTextConverter x:Key="BoolToEditSaveText" />
      <conv:BoolToBrushConverter x:Key="BoolToBrush" />
      <conv:BatchCellStatusToBrushConverter x:Key="BatchCellStatusToBrush" />
      <Style x:Key="ForegroundWhiteStyle" TargetType="{x:Type StackPanel}">
        <Setter Property="TextElement.Foreground" Value="Black"/>
      </Style>
      <Style x:Key="FluentShadowButtonBase" TargetType="{x:Type ui:Button}">
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="BorderBrush" Value="Transparent"/>
        <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Effect">
          <Setter.Value>
            <DropShadowEffect BlurRadius="0" ShadowDepth="0" Opacity="0"/>
          </Setter.Value>
        </Setter>
        <Style.Triggers>
          <Trigger Property="IsMouseOver" Value="True">
            <Setter Property="Effect">
              <Setter.Value>
                <DropShadowEffect BlurRadius="12" ShadowDepth="1" Opacity="0.18"/>
              </Setter.Value>
            </Setter>
          </Trigger>
          <Trigger Property="IsPressed" Value="True">
            <Setter Property="Effect">
              <Setter.Value>
                <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.12"/>
              </Setter.Value>
            </Setter>
          </Trigger>
        </Style.Triggers>
      </Style>
      <Style x:Key="IconOnlyButton" TargetType="{x:Type ui:Button}" BasedOn="{StaticResource FluentShadowButtonBase}">
        <Setter Property="Width" Value="36"/>
        <Setter Property="Height" Value="36"/>
        <Setter Property="Padding" Value="0"/>
        <Setter Property="FontSize" Value="14"/>
        <Setter Property="Margin" Value="8,0,0,0"/>
        <Setter Property="ToolTipService.ShowDuration" Value="30000"/>
      </Style>
      <Style x:Key="LeftNavButtonStyle" TargetType="{x:Type ui:Button}" BasedOn="{StaticResource FluentShadowButtonBase}">
        <Setter Property="Appearance" Value="Secondary"/>
        <Setter Property="FontSize" Value="20"/>
        <Setter Property="Height" Value="52"/>
        <Setter Property="HorizontalContentAlignment" Value="Left"/>
        <Setter Property="Padding" Value="12,8"/>
        <Setter Property="Margin" Value="0,0,0,8"/>
      </Style>
      <Style TargetType="GroupBox">
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="BorderBrush" Value="#CCCCCC"/>
        <Setter Property="Background" Value="#F5F5F5"/>
        <Setter Property="Padding" Value="8"/>
        <Setter Property="Foreground" Value="Black"/>
        <Setter Property="FontWeight" Value="Normal"/>
        <Setter Property="FontSize" Value="12"/>
        <Setter Property="Margin" Value="0,0,0,12"/>
      </Style>
  </Window.Resources>

  <Grid x:Name="RootGrid">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="150" />
      <ColumnDefinition Width="*" />
      <ColumnDefinition x:Name="SidePanelColumn" Width="560" MinWidth="560" />
    </Grid.ColumnDefinitions>

    <!-- ===== Tabs (top) ===== -->
    <TabControl Grid.Row="1" Grid.Column="2" x:Name="MainTabs" TabStripPlacement="Top">
      <TabItem x:Name="TabSetupInspect" Header="Setup &amp; Inspection">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel x:Name="SetupInspectRoot" Margin="8" Orientation="Vertical">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
              <ui:Button x:Name="BtnLoadImage"
                         Margin="0,0,8,0"
                         MinWidth="120"
                         ToolTip="Open an image"
                         Click="BtnLoadImage_Click" Height="48" Width="154">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Image24}" Margin="0,0,8,0" FontSize="16"/>
                                    <TextBlock Text="Load Picture" VerticalAlignment="Center"/>
                                </StackPanel>
                            </ui:Button>
                            <ui:Button x:Name="BtnLoadLayout"
                         Margin="0,0,8,0"
                         MinWidth="120"
                         Click="BtnLoadLayout_Click" Height="48" Width="138">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Folder24}" Margin="0,0,8,0" FontSize="16"/>
                                    <TextBlock Text="Load Layout" VerticalAlignment="Center"/>
                                </StackPanel>
                            </ui:Button>
                            <ui:Button x:Name="BtnSaveLayout"
                         MinWidth="120"
                         Click="BtnSaveLayout_Click" Height="52" Width="140">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Height="43" Width="118">
                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Save24}" Margin="0,0,8,0" FontSize="16"/>
                                    <TextBlock Text="Save Layout" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5">
                                        <TextBlock.RenderTransform>
                                            <TransformGroup>
                                                <ScaleTransform/>
                                                <SkewTransform AngleX="0"/>
                                                <RotateTransform/>
                                                <TranslateTransform X="0"/>
                                            </TransformGroup>
                                        </TextBlock.RenderTransform>
                                    </TextBlock>
                                </StackPanel>
                            </ui:Button>
                        </StackPanel>
                        <CheckBox Content="Layout Autosave"
                      IsChecked="{Binding LayoutAutosaveEnabled, Mode=TwoWay}"
                      />

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0"/>

                        <GroupBox Header="Layouts" Margin="0,0,0,12" Width="553">
                            <StackPanel>

                                <ListBox ItemsSource="{Binding LayoutProfiles.Profiles}"
                         SelectedItem="{Binding LayoutProfiles.SelectedProfile}"
                         Height="240">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding DisplayName}" Width="160"/>
                                                <TextBlock Text="{Binding CreatedUtc, StringFormat=\{0:yyyy-MM-dd HH:mm\}}"
                                   Opacity="0.6"
                                   Margin="8,0,0,0"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <ui:Button Command="{Binding LayoutProfiles.RefreshCommand}"
                             Margin="0,0,4,0" Width="100" Height="45">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.ArrowClockwise24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock Text="Refresh" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                    <ui:Button Command="{Binding LayoutProfiles.LoadSelectedCommand}"
                             Margin="0,0,4,0" Width="100" Height="45">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.ArrowRight24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock
                                        Text="Load" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                    <ui:Button Margin="0,0,4,0"
                             Click="SaveCurrentLayoutAs_Click" Width="100" Height="45">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Save24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock Text="Save as" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                    <ui:Button Command="{Binding LayoutProfiles.DeleteSelectedCommand}" Height="45" Width="100">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Delete24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock Text="Delete" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                    <ui:Button Margin="4,0,0,0"
                             Command="{Binding BlankDatasetCommand}"
                             ToolTip="Create a blank dataset for the current layout" Height="45" Width="100">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Add24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock Text="Blank " VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                </StackPanel>

                            </StackPanel>
                        </GroupBox>

                        <GroupBox x:Name="MasterRoiGroup"
                      Header="Master ROI"
                      Margin="0,0,0,12" Height="409" ScrollViewer.VerticalScrollBarVisibility="Disabled" FontSize="16">
                            <Grid Margin="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="10*"/>
                                    <ColumnDefinition Width="241*"/>
                                    <ColumnDefinition Width="250*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,33,191" Grid.ColumnSpan="3">
                                    <TextBlock Text="Master 1" FontWeight="SemiBold" Margin="0,0,0,6"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" MinWidth="49"/>
                                            <ColumnDefinition/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Shape:" VerticalAlignment="Center" Margin="0,0,8,0" Height="19"/>
                                        <ComboBox x:Name="ComboMasterRoiShape" Grid.Column="1" Height="37" Margin="27,0,256,0">
                                            <ComboBoxItem Content="Rectángulo"/>
                                            <ComboBoxItem Content="Círculo"/>
                                            <ComboBoxItem Content="Annulus"/>
                                        </ComboBox>
                                    </Grid>
                                    <Grid Margin="0,0,0,6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Type:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                        <ComboBox x:Name="ComboMasterRoiRole" Grid.Column="1" RenderTransformOrigin="0.521,0.527" Margin="38,0,260,0"/>
                                    </Grid>
                                    <WrapPanel Width="420">
                                        <ui:Button x:Name="BtnEditM1"
                               MinHeight="26"
                               Padding="8,4"
                               Click="BtnEditM1_Click" Height="36" Width="133" HorizontalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Edit24}" Margin="0,0,8,0" FontSize="16"/>
                                                <TextBlock Text="Edit M1" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button x:Name="BtnM1_Remove"
                               MinHeight="26"
                               Padding="8,4"
                               Margin="4,0,0,0"
                               Click="BtnM1_Remove_Click">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Delete24}" Margin="0,0,8,0" FontSize="16"/>
                                                <TextBlock Text="Remove" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button x:Name="BtnM1_Create"
                               MinHeight="26"
                               Padding="8,4"
                               Click="BtnM1_Create_Click" HorizontalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Add24}" Margin="0,0,8,0" FontSize="16"/>
                                                <TextBlock Text="Create" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </WrapPanel>
                                </StackPanel>

                                <StackPanel Margin="0,181,124,0" Height="190" VerticalAlignment="Top" Grid.ColumnSpan="3">
                                    <TextBlock Text="Master 2" FontWeight="SemiBold" Margin="0,0,0,6"/>
                                    <Grid Margin="0,0,0,6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Type:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                        <ComboBox x:Name="ComboM2Role" Grid.Column="1" Width="140"/>
                                    </Grid>
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Shape:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                        <ComboBox x:Name="ComboM2Shape" Grid.Column="1" Width="140">
                                            <ComboBoxItem Content="Rectángulo"/>
                                            <ComboBoxItem Content="Círculo"/>
                                            <ComboBoxItem Content="Annulus"/>
                                        </ComboBox>
                                    </Grid>
                                    <WrapPanel Width="493">
                                        <ui:Button x:Name="BtnEditM2"
                               MinHeight="26"
                               Padding="8,4"
                               Margin="4,0,0,0"
                               Click="BtnEditM2_Click">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Edit24}" Margin="0,0,8,0" FontSize="16"/>
                                                <TextBlock Text="Edit Master 2" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button x:Name="BtnM2_Remove"
                               MinHeight="26"
                               Padding="8,4"
                               Click="BtnM2_Remove_Click" Width="104" HorizontalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Delete24}" Margin="0,0,8,0" FontSize="16"/>
                                                <TextBlock Text="Remove" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button x:Name="BtnM2_Create"
                               MinHeight="26"
                               Padding="8,4"
                               Click="BtnM2_Create_Click" RenderTransformOrigin="4.067,0.5" HorizontalAlignment="Center" Width="120">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Add24}" Margin="0,0,8,0" FontSize="16"/>
                                                <TextBlock Text="Create" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </WrapPanel>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <WrapPanel Margin="0,12,0,12">
                            <ui:Button x:Name="BtnClearCanvas"
                         Click="BtnClearCanvas_Click">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Eraser24}" Margin="0,0,8,0" FontSize="16"/>
                                    <TextBlock Text="Clear Canvas" VerticalAlignment="Center"/>
                                </StackPanel>
                            </ui:Button>
                        </WrapPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">

                            <GroupBox Header="Analyze Options" Width="260" Height="381" Margin="0,0,0,0" Padding="8,16,8,8" ScrollViewer.CanContentScroll="True">
                                <StackPanel Margin="8,4,0,0">
                                    <StackPanel Height="102" CanVerticallyScroll="True">
                                        <CheckBox x:Name="ChkDisableRot"
                              Content="Disable rot"
                              IsChecked="{Binding DisableRot, Mode=TwoWay}"/>
                                        <CheckBox x:Name="ChkScaleLock"
                              Content="Lock scale"
                              IsChecked="{Binding ScaleLock, Mode=TwoWay}"/>
                                        <CheckBox x:Name="ChkUseLocalMatcher"
                              Content="Use local matcher"
                              ToolTip="Force local matcher"
                              IsChecked="True"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                        <TextBlock Text="Position tolerance (px)"
                               Width="146"
                               VerticalAlignment="Center"/>
                                        <TextBox Width="76"
                             Text="{Binding AnalyzePosTolerancePx, Mode=TwoWay, StringFormat=\{0:F2\}, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                        <TextBlock Text="Angle tolerance (deg)"
                               Width="146"
                               VerticalAlignment="Center"/>
                                        <TextBox Width="70"
                             Text="{Binding AnalyzeAngToleranceDeg, Mode=TwoWay, StringFormat=\{0:F2\}, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>
                                    <ui:Button x:Name="BtnAnalyzeMaster"
                             Click="BtnAnalyzeMaster_Click">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Target24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock Text="Force Analyze Master" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                </StackPanel>
                            </GroupBox>

                            <StackPanel Orientation="Vertical">
                                <GroupBox Header="Master 1 Analyze" Width="260">
                                    <StackPanel Margin="8,4,0,0">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="Feature:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <ComboBox x:Name="ComboFeature" Width="110"
                                SelectedValuePath="Content"
                                SelectedValue="{Binding AnalyzeFeatureM1, Mode=TwoWay}">
                                                <ComboBoxItem Content="auto"/>
                                                <ComboBoxItem Content="sift"/>
                                                <ComboBoxItem Content="orb"/>
                                                <ComboBoxItem Content="tm_rot"/>
                                                <ComboBoxItem Content="edges"/>
                                            </ComboBox>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                            <TextBlock Text="Thr:" VerticalAlignment="Center"/>
                                            <TextBox x:Name="TxtThr" Width="40"
                               Margin="4,0,0,0"
                               Text="{Binding AnalyzeThrM1, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox Header="Master 2 Analyze" Width="260">
                                    <StackPanel Margin="8,4,0,0">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="Feature:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <ComboBox x:Name="ComboFeatureM2" Width="110"
                                SelectedValuePath="Content"
                                SelectedValue="{Binding AnalyzeFeatureM2, Mode=TwoWay}">
                                                <ComboBoxItem Content="auto"/>
                                                <ComboBoxItem Content="sift"/>
                                                <ComboBoxItem Content="orb"/>
                                                <ComboBoxItem Content="tm_rot"/>
                                                <ComboBoxItem Content="edges"/>
                                            </ComboBox>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                            <TextBlock Text="Thr:" VerticalAlignment="Center"/>
                                            <TextBox x:Name="TxtThrM2" Width="40"
                               Margin="4,0,0,0"
                               Text="{Binding AnalyzeThrM2, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox Header="Match Options" Width="260">
                                    <StackPanel Margin="8,4,0,0">
                                        <StackPanel Orientation="Horizontal" Margin="0,4,0,8">
                                            <TextBlock Text="RotRange:" VerticalAlignment="Center"/>
                                            <TextBox x:Name="TxtRot" Width="60" Margin="4,0,8,0" Text="10"/>
                                            <TextBlock Text="ScaleMin:" VerticalAlignment="Center"/>
                                            <TextBox x:Name="TxtSMin" Width="60" Margin="4,0,8,0" Text="0.95"/>
                                            <TextBlock Text="ScaleMax:" VerticalAlignment="Center"/>
                                            <TextBox x:Name="TxtSMax" Width="60" Margin="4,0,0,0" Text="1.05"/>
                                        </StackPanel>
                                        <WrapPanel>
                                            <ui:Button x:Name="BtnSavePreset" Click="BtnSavePreset_Click" Margin="0,0,8,0">
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Save24}" Margin="0,0,8,0" FontSize="16"/>
                                                    <TextBlock Text="Save Preset" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </ui:Button>
                                        </WrapPanel>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </StackPanel>

                        <GroupBox x:Name="InspectionRoisGroup" Header="Inspection ROIs" Margin="0,12,0,0">
                            <StackPanel Margin="8,4,0,0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,4" VerticalAlignment="Center">
                                    <TextBlock Text="Inspection 1" Width="80" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="CmbShapeInspection1"
                            Width="80"
                            Tag="1"
                            ItemsSource="{Binding AvailableShapes}"
                            SelectedItem="{Binding DataContext.InspectionRois[0].Shape, ElementName=WorkflowHost, Mode=TwoWay}"
                            SelectionChanged="InspectionShape_SelectionChanged"/>
                                    <ui:Button x:Name="BtnCreateInspection1"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             MinHeight="26"
                             Tag="1"
                             Click="BtnCreateInspection_Click">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.AddSquare24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock Text="Create ROI 1" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                    <ui:Button Margin="4,0,0,0"
                             Padding="12,4"
                             MinHeight="26"
                             DataContext="{Binding DataContext.InspectionRois[0], ElementName=WorkflowHost}"
                             Click="BtnToggleEdit_Click"
                             IsEnabled="{Binding Enabled}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Edit24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="{Binding Path=Index, StringFormat=Edit ROI{0}}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection1, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[0].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsEditable}" Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Save24}" Margin="0,0,8,0" FontSize="16"/>
                                                                    <TextBlock Text="{Binding Path=Index, StringFormat=Save ROI{0}}" VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnAddOkInspection1"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Command="{Binding DataContext.AddRoiToOkCommand, ElementName=WorkflowHost}"
                             CommandParameter="{Binding Inspection1}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.CheckmarkCircle24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Add to OK" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection1, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[0].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnAddNgInspection1"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Command="{Binding DataContext.AddRoiToNgCommand, ElementName=WorkflowHost}"
                             CommandParameter="{Binding Inspection1}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.DismissCircle24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Add to NG" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection1, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[0].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnRemoveInspection1"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Click="BtnRemoveInspection1_Click">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Delete24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Remove 1" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection1, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,4,0,4" VerticalAlignment="Center">
                                    <TextBlock Text="Inspection 2" Width="80" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="CmbShapeInspection2"
                            Width="80"
                            Tag="2"
                            ItemsSource="{Binding AvailableShapes}"
                            SelectedItem="{Binding DataContext.InspectionRois[1].Shape, ElementName=WorkflowHost, Mode=TwoWay}"
                            SelectionChanged="InspectionShape_SelectionChanged"/>
                                    <ui:Button x:Name="BtnCreateInspection2"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             MinHeight="26"
                             Tag="2"
                             Click="BtnCreateInspection_Click">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.AddSquare24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock Text="Create ROI 2" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                    <ui:Button Margin="4,0,0,0"
                             Padding="12,4"
                             MinHeight="26"
                             DataContext="{Binding DataContext.InspectionRois[1], ElementName=WorkflowHost}"
                             Click="BtnToggleEdit_Click"
                             IsEnabled="{Binding Enabled}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Edit24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="{Binding Path=Index, StringFormat=Edit ROI{0}}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection2, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[1].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsEditable}" Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Save24}" Margin="0,0,8,0" FontSize="16"/>
                                                                    <TextBlock Text="{Binding Path=Index, StringFormat=Save ROI{0}}" VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnAddOkInspection2"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Command="{Binding DataContext.AddRoiToOkCommand, ElementName=WorkflowHost}"
                             CommandParameter="{Binding Inspection2}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.CheckmarkCircle24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Add to OK" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection2, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[1].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnAddNgInspection2"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Command="{Binding DataContext.AddRoiToNgCommand, ElementName=WorkflowHost}"
                             CommandParameter="{Binding Inspection2}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.DismissCircle24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Add to NG" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection2, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[1].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnRemoveInspection2"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Click="BtnRemoveInspection2_Click">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Delete24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Remove 2" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection2, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,4,0,4" VerticalAlignment="Center">
                                    <TextBlock Text="Inspection 3" Width="80" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="CmbShapeInspection3"
                            Width="80"
                            Tag="3"
                            ItemsSource="{Binding AvailableShapes}"
                            SelectedItem="{Binding DataContext.InspectionRois[2].Shape, ElementName=WorkflowHost, Mode=TwoWay}"
                            SelectionChanged="InspectionShape_SelectionChanged"/>
                                    <ui:Button x:Name="BtnCreateInspection3"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             MinHeight="26"
                             Tag="3"
                             Click="BtnCreateInspection_Click">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.AddSquare24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock Text="Create ROI 3" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                    <ui:Button Margin="4,0,0,0"
                             Padding="12,4"
                             MinHeight="26"
                             DataContext="{Binding DataContext.InspectionRois[2], ElementName=WorkflowHost}"
                             Click="BtnToggleEdit_Click"
                             IsEnabled="{Binding Enabled}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Edit24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="{Binding Path=Index, StringFormat=Edit ROI{0}}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection3, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[2].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsEditable}" Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Save24}" Margin="0,0,8,0" FontSize="16"/>
                                                                    <TextBlock Text="{Binding Path=Index, StringFormat=Save ROI{0}}" VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnAddOkInspection3"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Command="{Binding DataContext.AddRoiToOkCommand, ElementName=WorkflowHost}"
                             CommandParameter="{Binding Inspection3}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.CheckmarkCircle24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Add to OK" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection3, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[2].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnAddNgInspection3"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Command="{Binding DataContext.AddRoiToNgCommand, ElementName=WorkflowHost}"
                             CommandParameter="{Binding Inspection3}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.DismissCircle24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Add to NG" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection3, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[2].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnRemoveInspection3"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Click="BtnRemoveInspection3_Click">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Delete24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Remove 3" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection3, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,4,0,12" VerticalAlignment="Center">
                                    <TextBlock Text="Inspection 4" Width="80" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="CmbShapeInspection4"
                            Width="80"
                            Tag="4"
                            ItemsSource="{Binding AvailableShapes}"
                            SelectedItem="{Binding DataContext.InspectionRois[3].Shape, ElementName=WorkflowHost, Mode=TwoWay}"
                            SelectionChanged="InspectionShape_SelectionChanged"/>
                                    <ui:Button x:Name="BtnCreateInspection4"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             MinHeight="26"
                             Tag="4"
                             Click="BtnCreateInspection_Click">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.AddSquare24}" Margin="0,0,8,0" FontSize="16"/>
                                            <TextBlock Text="Create ROI 4" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </ui:Button>
                                    <ui:Button Margin="4,0,0,0"
                             Padding="12,4"
                             MinHeight="26"
                             DataContext="{Binding DataContext.InspectionRois[3], ElementName=WorkflowHost}"
                             Click="BtnToggleEdit_Click"
                             IsEnabled="{Binding Enabled}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Edit24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="{Binding Path=Index, StringFormat=Edit ROI{0}}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection4, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[3].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsEditable}" Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Save24}" Margin="0,0,8,0" FontSize="16"/>
                                                                    <TextBlock Text="{Binding Path=Index, StringFormat=Save ROI{0}}" VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnAddOkInspection4"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Command="{Binding DataContext.AddRoiToOkCommand, ElementName=WorkflowHost}"
                             CommandParameter="{Binding Inspection4}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.CheckmarkCircle24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Add to OK" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection4, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[3].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnAddNgInspection4"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Command="{Binding DataContext.AddRoiToNgCommand, ElementName=WorkflowHost}"
                             CommandParameter="{Binding Inspection4}">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.DismissCircle24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Add to NG" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection4, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding DataContext.InspectionRois[3].Enabled, ElementName=WorkflowHost}" Value="False">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                    <ui:Button x:Name="BtnRemoveInspection4"
                             Margin="4,0,0,0"
                             Padding="4,2"
                             Click="BtnRemoveInspection4_Click">
                                        <ui:Button.Style>
                                            <Style TargetType="{x:Type ui:Button}">
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Delete24}" Margin="0,0,8,0" FontSize="16"/>
                                                            <TextBlock Text="Remove 4" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DataContext.Inspection4, ElementName=WorkflowHost}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ui:Button.Style>
                                    </ui:Button>
                                </StackPanel>

                                <workflow:WorkflowControl x:Name="WorkflowHost" Margin="0,12,0,0"/>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            <TabItem Header="Batch Inspection" DataContext="{Binding DataContext, ElementName=WorkflowHost}">
                <Grid Margin="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Margin="8">
                        <TextBox Width="315"
                     IsReadOnly="True"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     VerticalScrollBarVisibility="Auto"
                     Text="{Binding BatchFolder, UpdateSourceTrigger=PropertyChanged}"/>
                        <ui:Button Margin="8,0,0,0"
                       Padding="12,4"
                       Command="{Binding BrowseBatchFolderCommand}">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.FolderOpen24}" Margin="0,0,8,0" FontSize="16"/>
                                <TextBlock Text="Browse" VerticalAlignment="Center"/>
                            </StackPanel>
                        </ui:Button>

                        <!-- ▶ Play = Start/Resume -->
                        <ui:Button Style="{StaticResource IconOnlyButton}"
                       ToolTip="Play / Start or Resume"
                       AutomationProperties.Name="Play"
                       Command="{Binding StartBatchCommand}">
                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Play24}" FontSize="16"/>
                        </ui:Button>

                        <!-- ⏸ Pause -->
                        <ui:Button Style="{StaticResource IconOnlyButton}"
                       ToolTip="Pause"
                       AutomationProperties.Name="Pause"
                       Command="{Binding PauseBatchCommand}">
                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Pause24}" FontSize="16"/>
                        </ui:Button>

                        <!-- ■ Stop -->
                        <ui:Button Style="{StaticResource IconOnlyButton}"
                       ToolTip="Stop"
                       AutomationProperties.Name="Stop"
                       Command="{Binding StopBatchCommand}">
                            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Stop24}" FontSize="16"/>
                        </ui:Button>

                        <TextBlock Margin="12,0,0,0"
                       VerticalAlignment="Center"
                       Text="{Binding BatchSummary}"/>
                    </StackPanel>

                    <StackPanel Grid.Row="1" Margin="8" Orientation="Vertical">
                        <TextBlock Text="Heatmap cutoff (%)"/>
                        <Slider Minimum="0"
                    Maximum="100"
                    TickFrequency="5"
                    IsSnapToTickEnabled="True"
                    Value="{Binding HeatmapCutoffPercent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        <TextBlock Margin="0,8,0,8"
                       Text="{Binding HeatmapInfo}"/>

                        <TextBlock Text="Delay per ROI (seconds)"/>
                        <Slider Minimum="0"
                    Maximum="10"
                    TickFrequency="0.1"
                    IsSnapToTickEnabled="True"
                    Value="{Binding BatchPausePerRoiSeconds, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        <TextBlock Margin="0,4,0,0"
                       Text="{Binding BatchPausePerRoiSeconds, StringFormat='Delay: {0:0.0}s'}"/>
                    </StackPanel>

                    <Grid Grid.Row="2" Margin="8" x:Name="BatchGrid"
                Loaded="BatchGrid_Loaded"
                DataContextChanged="BatchGrid_DataContextChanged">
                        <!-- Imagen base -->
                        <Image x:Name="BaseImage"
                   Source="{Binding BatchImageSource}"
                   Stretch="Uniform"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   SnapsToDevicePixels="True"
                   RenderOptions.BitmapScalingMode="HighQuality"
                   Panel.ZIndex="0"/>

                        <!-- Overlay exactamente encima del rectángulo visible de BaseImage -->
                        <Canvas x:Name="Overlay"
                    Width="{Binding ElementName=BaseImage, Path=ActualWidth}"
                    Height="{Binding ElementName=BaseImage, Path=ActualHeight}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    IsHitTestVisible="False"
                    Panel.ZIndex="1">
                            <!-- Heatmap del ROI: se posiciona y escala desde código -->
                            <Image x:Name="HeatmapImage"
                     Stretch="Fill"
                     Opacity="0.65"
                     SnapsToDevicePixels="True"
                     UseLayoutRounding="True"
                     RenderOptions.BitmapScalingMode="HighQuality"/>
                        </Canvas>
                    </Grid>

                    <DataGrid Grid.Row="3"
                    Margin="8"
                    ItemsSource="{Binding BatchRows}"
                    AutoGenerateColumns="False"
                    HeadersVisibility="Column"
                    IsReadOnly="True"
                    CanUserAddRows="False"
                    RowHeaderWidth="0">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="File" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding FileName}"
                               Cursor="Hand"
                               TextDecorations="Underline"
                               MouseLeftButtonUp="BatchFile_Click"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="ROI 1" Width="70">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Ellipse Width="18" Height="18"
                             Fill="{Binding ROI1, Converter={StaticResource BatchCellStatusToBrush}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="ROI 2" Width="70">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Ellipse Width="18" Height="18"
                             Fill="{Binding ROI2, Converter={StaticResource BatchCellStatusToBrush}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="ROI 3" Width="70">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Ellipse Width="18" Height="18"
                             Fill="{Binding ROI3, Converter={StaticResource BatchCellStatusToBrush}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="ROI 4" Width="70">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Ellipse Width="18" Height="18"
                             Fill="{Binding ROI4, Converter={StaticResource BatchCellStatusToBrush}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <TextBlock Grid.Row="4"
                     Margin="8"
                     Text="{Binding BatchStatus}"/>
                </Grid>
            </TabItem>
            <TabItem x:Name="TabComms" Header="Comms">
                <Grid Margin="8" x:Name="CommsRoot">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,12">
                        <TextBlock Text="PLC IP:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Width="130"
                     Text="{Binding PlcIpAddress, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock Text="Rack:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                        <TextBox Width="40"
                     Text="{Binding Rack}" IsReadOnly="True"/>

                        <TextBlock Text="Slot:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                        <TextBox Width="40"
                     Text="{Binding Slot}" IsReadOnly="True"/>

                        <ui:Button Margin="12,0,0,0"
                       Padding="10,3"
                       Command="{Binding ConnectCommand}">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.PlugConnected24}" Margin="0,0,8,0" FontSize="16"/>
                                <TextBlock Text="Connect" VerticalAlignment="Center"/>
                            </StackPanel>
                        </ui:Button>

                        <ui:Button Margin="4,0,0,0"
                       Padding="10,3"
                       Command="{Binding DisconnectCommand}">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.PlugDisconnected24}" Margin="0,0,8,0" FontSize="16"/>
                                <TextBlock Text="Disconnect" VerticalAlignment="Center"/>
                            </StackPanel>
                        </ui:Button>

                        <TextBlock Margin="12,0,0,0"
                       VerticalAlignment="Center"
                       Text="{Binding ConnectionStatus}"/>
                    </StackPanel>

                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <GroupBox Header="Inputs" Grid.Column="0" Margin="0,0,8,0">
                            <ItemsControl ItemsSource="{Binding Inputs}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <DockPanel Margin="0,2">
                                            <Ellipse Width="16" Height="16"
                               Margin="0,0,6,0"
                               Fill="{Binding IsOn, Converter={StaticResource BoolToBrush}}"/>
                                            <TextBlock Text="{Binding DisplayName}"
                                 VerticalAlignment="Center"
                                 Width="140"/>
                                            <ui:Button Margin="8,0,0,0"
                                 Padding="6,2"
                                 Command="{Binding DataContext.ToggleInputCommand, RelativeSource={RelativeSource AncestorType=GroupBox}}"
                                 CommandParameter="{Binding Id}">
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Power24}" Margin="0,0,6,0" FontSize="16"/>
                                                    <TextBlock Text="Enable" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </ui:Button>
                                        </DockPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </GroupBox>

                        <GroupBox Header="Outputs" Grid.Column="1">
                            <ItemsControl ItemsSource="{Binding Outputs}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <DockPanel Margin="0,2">
                                            <Ellipse Width="16" Height="16"
                               Margin="0,0,6,0"
                               Fill="{Binding IsOn, Converter={StaticResource BoolToBrush}}"/>
                                            <TextBlock Text="{Binding DisplayName}"
                                 VerticalAlignment="Center"
                                 Width="140"/>
                                            <ui:Button Margin="8,0,0,0"
                                 Padding="6,2"
                                 Command="{Binding DataContext.ToggleOutputCommand, RelativeSource={RelativeSource AncestorType=GroupBox}}"
                                 CommandParameter="{Binding Id}">
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Power24}" Margin="0,0,6,0" FontSize="16"/>
                                                    <TextBlock Text="Enable" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </ui:Button>
                                        </DockPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </GroupBox>
                    </Grid>
                </Grid>
            </TabItem>
        </TabControl>

    <Border Grid.Row="1" Grid.Column="0"
            BorderBrush="#D0D0D0" BorderThickness="0,0,1,0"
            Background="#F7F7F7">
      <StackPanel Margin="8">
        <ui:Button Style="{StaticResource LeftNavButtonStyle}">
          <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Settings24}" FontSize="18" Margin="0,0,10,0"/>
            <TextBlock Text="Layout Setup" VerticalAlignment="Center"/>
          </StackPanel>
        </ui:Button>
        <ui:Button Style="{StaticResource LeftNavButtonStyle}">
          <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.Crop24}" FontSize="18" Margin="0,0,10,0"/>
            <TextBlock Text="ROIs Management" VerticalAlignment="Center"/>
          </StackPanel>
        </ui:Button>
        <ui:Button Style="{StaticResource LeftNavButtonStyle}">
          <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.PlayCircle24}" FontSize="18" Margin="0,0,10,0"/>
            <TextBlock Text="Batch Inspection" VerticalAlignment="Center"/>
          </StackPanel>
        </ui:Button>
        <ui:Button Style="{StaticResource LeftNavButtonStyle}" Margin="0">
          <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
            <ui:SymbolIcon Symbol="{x:Static ui:SymbolRegular.PlugConnected24}" FontSize="18" Margin="0,0,10,0"/>
            <TextBlock Text="Comms" VerticalAlignment="Center"/>
          </StackPanel>
        </ui:Button>
      </StackPanel>
    </Border>

      <!-- ===== Viewer/Canvas (right) ===== -->
      <Grid Grid.Column="1" Grid.RowSpan="2" x:Name="ViewerHost">
        <Grid Margin="10">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>

                <AdornerDecorator Grid.Row="1" Margin="0,8,0,0">
                    <Grid Background="#111">
                        <Grid>
                            <Image x:Name="ImgMain" Stretch="Uniform" Panel.ZIndex="0" />
                            <Image x:Name="HeatmapOverlay"
                       IsHitTestVisible="False"
                       Stretch="Fill"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Top"
                       SnapsToDevicePixels="True"
                       Opacity="{Binding HeatmapOverlayOpacity, RelativeSource={RelativeSource AncestorType=Window}}"
                       Visibility="Collapsed"
                       Panel.ZIndex="1"/>
                            <Canvas x:Name="CanvasROI"
                        Background="Transparent"
                        IsHitTestVisible="True"
                       Panel.ZIndex="2"/>
                            <local:RoiOverlay x:Name="RoiOverlay"
                                  Visibility="Collapsed"
                                  IsHitTestVisible="False"
                                  Panel.ZIndex="3"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"/>
                        </Grid>
                    </Grid>
                </AdornerDecorator>

                <Border x:Name="SnackPanel"
                  Grid.Row="1"
                  Grid.RowSpan="3"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Top"
                  Margin="0,12,0,0"
                  Padding="10,6"
                  Background="#F22C2C2C"
                  CornerRadius="6"
                  Visibility="Collapsed"
                  Panel.ZIndex="900"
                  IsHitTestVisible="False">
                    <TextBlock x:Name="SnackText"
                       Foreground="White"
                       FontWeight="SemiBold"
                       TextWrapping="Wrap"
                       MaxWidth="520"/>
                </Border>

                <!-- ===== HUD: ROI list (top-left) ===== -->
                <Grid x:Name="RoiHudOverlay"
                Grid.Row="1"
                VerticalAlignment="Top"
                HorizontalAlignment="Left"
                Margin="12,8,0,0"
                Panel.ZIndex="400"
                IsHitTestVisible="True"
                Visibility="Collapsed">
                    <Border x:Name="RoiHudPanel"
                      Background="#CC1A1A1A"
                      BorderBrush="#39FF14"
                      BorderThickness="1.2"
                      CornerRadius="8"
                      Padding="10">
                        <Border.Effect>
                            <DropShadowEffect Color="#AA000000"
                                    BlurRadius="8"
                                    ShadowDepth="0" />
                        </Border.Effect>
                        <StackPanel x:Name="RoiHudStack" />
                    </Border>
                </Grid>

                <Border x:Name="RoiVisibilityPanel"
                  Grid.Row="2"
                  HorizontalAlignment="Left"
                  VerticalAlignment="Center"
                  Margin="12,8,12,12"
                  Padding="10,8"
                  Background="#CC1E1E1E"
                  CornerRadius="8"
                  Panel.ZIndex="1"
                  DataContext="{Binding DataContext, ElementName=WorkflowHost}">
                    <StackPanel Orientation="Horizontal">
                        <StackPanel.Resources>
                            <Style TargetType="Button">
                                <Setter Property="Foreground" Value="White"/>
                            </Style>
                            <Style TargetType="ToggleButton">
                                <Setter Property="Foreground" Value="White"/>
                            </Style>
                            <Style TargetType="CheckBox">
                                <Setter Property="Foreground" Value="White"/>
                            </Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="White"/>
                            </Style>
                        </StackPanel.Resources>
                        <CheckBox x:Name="ChkShowMaster1Pattern"
                        IsChecked="{Binding ShowMaster1Pattern}"
                        Margin="0,0,6,0"
                        Checked="RoiVisibilityCheckChanged"
                        Unchecked="RoiVisibilityCheckChanged">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8A4;" FontFamily="Segoe MDL2 Assets" Margin="0,0,4,0"/>
                                <TextBlock Text="Master 1"/>
                            </StackPanel>
                        </CheckBox>
                        <CheckBox x:Name="ChkShowMaster1Inspection"
                        IsChecked="{Binding ShowMaster1Inspection}"
                        Margin="0,0,6,0"
                        Checked="RoiVisibilityCheckChanged"
                        Unchecked="RoiVisibilityCheckChanged">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8A4;" FontFamily="Segoe MDL2 Assets" Margin="0,0,4,0"/>
                                <TextBlock Text="Search 1"/>
                            </StackPanel>
                        </CheckBox>
                        <CheckBox x:Name="ChkShowMaster2Pattern"
                        IsChecked="{Binding ShowMaster2Pattern}"
                        Margin="0,0,6,0"
                        Checked="RoiVisibilityCheckChanged"
                        Unchecked="RoiVisibilityCheckChanged">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8A4;" FontFamily="Segoe MDL2 Assets" Margin="0,0,4,0"/>
                                <TextBlock Text="Master 2"/>
                            </StackPanel>
                        </CheckBox>
                        <CheckBox x:Name="ChkShowMaster2Inspection"
                        IsChecked="{Binding ShowMaster2Inspection}"
                        Margin="0,0,6,0"
                        Checked="RoiVisibilityCheckChanged"
                        Unchecked="RoiVisibilityCheckChanged">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8A4;" FontFamily="Segoe MDL2 Assets" Margin="0,0,4,0"/>
                                <TextBlock Text="Search 2"/>
                            </StackPanel>
                        </CheckBox>
                        <CheckBox x:Name="ChkShowInspectionRoi"
                        IsChecked="{Binding ShowInspectionRoi}"
                        Margin="0,0,6,0"
                        Checked="RoiVisibilityCheckChanged"
                        Unchecked="RoiVisibilityCheckChanged">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8A4;" FontFamily="Segoe MDL2 Assets" Margin="0,0,4,0"/>
                                <TextBlock Text="Inspection"/>
                            </StackPanel>
                        </CheckBox>
                    </StackPanel>
                </Border>
            </Grid>
            <Grid x:Name="DiskStatusHUD"
              HorizontalAlignment="Right"
              VerticalAlignment="Top"
              Margin="12"
              Panel.ZIndex="950"
              Visibility="Collapsed"
              IsHitTestVisible="False">
                <Border x:Name="DiskStatusPanel"
                  Background="#CC000000"
                  BorderBrush="#39FF14"
                  BorderThickness="1.5"
                  CornerRadius="0"
                  Padding="8">
                    <TextBlock x:Name="DiskStatusText"
                       Text=""
                       FontFamily="Segoe UI"
                       FontWeight="Bold"
                       FontSize="22"
                       Foreground="White"/>
                </Border>
            </Grid>
            <!-- ===== HUD: bottom-right Heatmap controls ===== -->
            <Grid x:Name="HudOverlay" Panel.ZIndex="1000" IsHitTestVisible="True">
                <Border x:Name="HeatmapHUD"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Bottom"
                  Margin="16"
                  Background="#CC0F0F0F"
                  CornerRadius="8"
                  Padding="10"
                  IsHitTestVisible="True">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <CheckBox x:Name="ChkHeatmap"
                        Content="Heatmap"
                        IsChecked="True"
                        Margin="0,0,8,0"/>
                        <TextBlock x:Name="ResultLabel"
                         Text="Result: --"
                         Foreground="LightGreen"
                         FontFamily="Segoe UI"
                         FontWeight="SemiBold"
                         Margin="0,0,8,0"/>
                        <TextBlock x:Name="HeatmapScaleLabel"
                         Text="Heatmap Scale: 1.00"
                         Foreground="#39FF14"
                         FontFamily="Segoe UI"
                         FontWeight="SemiBold"
                         Margin="0,0,8,0"/>
                        <Slider x:Name="HeatmapScaleSlider"
                      Width="160"
                      Minimum="0.10"
                      Maximum="2.00"
                      Value="1.00"
                      Margin="0,0,12,0"/>
                        <TextBlock Text="Opacity"
                         Foreground="#39FF14"
                         FontFamily="Segoe UI"
                         FontWeight="SemiBold"
                         Margin="0,0,8,0"/>
                        <Slider x:Name="HeatmapOpacitySlider"
                      Width="140"
                      Minimum="0"
                      Maximum="1"
                      TickFrequency="0.05"
                      IsSnapToTickEnabled="True"
                      Value="{Binding HeatmapOverlayOpacity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>
